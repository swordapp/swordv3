<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SWORD 3.0 Protocol Behaviours</title>

    <link rel="stylesheet" href="assets/css/swordv3.css">
</head>
<body>

<h1 class="main_title">SWORD 3.0 Protocol Behaviours</h1><div class=nav>
<div class=toc>
<ul>
<li><a href="#1.">1. Retrieve the Service Document</a></li>
<li><a href="#2.">2. Creating New Objects</a><ul>
<li><a href="#2.1.">2.1. Creating Objects with only Metadata</a></li>
<li><a href="#2.2.">2.2. Creating Objects with only By-Reference Files</a></li>
<li><a href="#2.3.">2.3. Creating Objects with both Metadata and By-Reference Files</a></li>
<li><a href="#2.4.">2.4. Creating Objects with Binary Files</a></li>
<li><a href="#2.5.">2.5. Creating Objects with Packaged Content</a></li>
<li><a href="#2.6.">2.6. Creating Objects with Segmented File Upload</a></li>
</ul>
</li>
<li><a href="#3.">3. Retrieving all or part of Objects</a><ul>
<li><a href="#3.1.">3.1. Retrieving an Object's Status</a></li>
<li><a href="#3.2.">3.2. Retrieving the Metadata from an Object</a></li>
<li><a href="#3.3.">3.3. Retrieving a Binary File from an Object</a></li>
<li><a href="#3.4.">3.4. Retrieving a Packaged Content representation of an Object</a></li>
</ul>
</li>
<li><a href="#4.">4. Appending to existing Objects</a><ul>
<li><a href="#4.1.">4.1. Appending Metadata to an Object</a></li>
<li><a href="#4.2.">4.2. Appending By-Reference Files to an Object</a></li>
<li><a href="#4.3.">4.3. Appending Metadata and By-Reference Files to an Object</a></li>
<li><a href="#4.4.">4.4. Appending a single Binary File to an Object</a></li>
<li><a href="#4.5.">4.5. Appending Packaged Content to an Object</a></li>
<li><a href="#4.6.">4.6. Append of Binary Files to an Object via Segmented File Upload</a></li>
<li><a href="#4.7.">4.7. Append of Packaged Content to an Object via Segmented File Upload</a></li>
</ul>
</li>
<li><a href="#5.">5. Replacing all or part of existing Objects</a><ul>
<li><a href="#5.1.">5.1. Replacing the Metadata of an Object</a></li>
<li><a href="#5.2.">5.2. Replacing a single File in an Object</a></li>
<li><a href="#5.3.">5.3. Replacing a single File in an Object with a By-Reference File</a></li>
<li><a href="#5.4.">5.4. Replacing a single File in an Object with a Segmented Upload</a></li>
<li><a href="#5.5.">5.5. Replacing the FileSet of an Object with By-Reference Files</a></li>
<li><a href="#5.6.">5.6. Replacing the FileSet of an Object with a single Binary File</a></li>
<li><a href="#5.7.">5.7. Replacing the FileSet of an Object with a single Binary File via Segmented File Upload</a></li>
<li><a href="#5.8.">5.8. Replacing an Object with Metadata only</a></li>
<li><a href="#5.9.">5.9. Replacing an Object with By-Reference Files only</a></li>
<li><a href="#5.10.">5.10. Replacing an Object with Metadata and By-Reference Files</a></li>
<li><a href="#5.11.">5.11. Replacing an Object with a single Binary File</a></li>
<li><a href="#5.12.">5.12. Replacing an Object with Packaged Content</a></li>
<li><a href="#5.13.">5.13. Replacing an Object with a single Binary File via Segmented File Upload</a></li>
<li><a href="#5.14.">5.14. Replacing an Object with Packaged Content via Segmented File Upload</a></li>
</ul>
</li>
<li><a href="#6.">6. Deleting all or part of Objects</a><ul>
<li><a href="#6.1.">6.1. Deleting an Object's Metadata</a></li>
<li><a href="#6.2.">6.2. Deleting a single Binary File from an Object</a></li>
<li><a href="#6.3.">6.3. Deleting all the Files from an Object</a></li>
<li><a href="#6.4.">6.4. Deleting the entire Object</a></li>
</ul>
</li>
<li><a href="#7.">7. File Segments</a><ul>
<li><a href="#7.1.">7.1. Initialise a Segmented File Upload</a></li>
<li><a href="#7.2.">7.2. Upload a File Segment</a></li>
<li><a href="#7.3.">7.3. Abort a Segmented File Upload</a></li>
<li><a href="#7.4.">7.4. Retrieve information about a Segmented File Upload</a></li>
</ul>
</li>
<li><a href="#8.">8. Completing Previously In-Progress Deposits</a>
</div></li>
</ul>
</div>
<div class=spec>
DRAFT 4</p>
<p>Last modified: 2019-06-05</p>
<p><a name="1."></a></p>
<h1>1. Retrieve the Service Document</h1>
<p>Request from the server a list of the Service-URLs that the client can deposit to.  A Service-URL allows the server to support multiple 
different deposit conditions - each URL may have its own set of rules/workflows behind it; for example, Service-URLs may be 
subject-specific, organisational-specific, or process-specific.  It is up to the client to determine which is the suitable URL for its 
deposit, based on the information provided by the server.  The list of Service-URLs may vary depending on the authentication credentials 
supplied by the client.</p>
<p>This request can be made against a root Service-URL, which will describe the capabilities of the entire server, for information about the 
full list of Service-URLs, or can be made against an individual Service-URL for information just about that service.</p>
<p><strong>Protocol Operation</strong></p>
<ul>
<li>GET Service-URL</li>
</ul>
<p><strong>Request Requirements</strong></p>
<ul>
<li>MAY specify <code>Authorization</code> and <code>On-Behalf-Of</code> headers (i.e. if authenticating this request)</li>
</ul>
<p><strong>Server Requirements</strong></p>
<ul>
<li>If <code>Authorization</code> (and optionally <code>On-Behalf-Of</code>) headers are provided, MUST authenticate the request</li>
</ul>
<p><strong>Response Requirements</strong></p>
<ul>
<li>If authentication fails, MUST respond with a <code>403</code></li>
<li>If <code>Authorization</code> (and optionally <code>On-Behalf-Of</code>) headers are provided, MUST only list Service-URLs in the Service Document for which a deposit request would be permitted</li>
<li>MUST respond with a valid Service Document or a suitable error response</li>
</ul>
<p><a name="2."></a></p>
<h1>2. Creating New Objects</h1>
<p><a name="2.1."></a></p>
<h2>2.1. Creating Objects with only Metadata</h2>
<p>Create a new Object on the server, sending only Metadata content (i.e. no Binary File content, and no By-Reference Files).</p>
<p><strong>Protocol Operation</strong></p>
<ul>
<li>POST Service-URL</li>
</ul>
<p><strong>Request Requirements</strong></p>
<ul>
<li>MAY specify <code>Authorization</code> and <code>On-Behalf-Of</code> headers (i.e. if authenticating this request)</li>
<li>MUST provide the <code>Content-Disposition</code> header, with the appropriate value for the request</li>
<li>MUST provide the <code>Content-Type</code> and <code>Digest</code> headers</li>
<li>SHOULD provide the <code>Content-Length</code></li>
<li>SHOULD provide the <code>Metadata-Format</code> header</li>
<li>MUST provide only the Metadata document</li>
<li>MAY provide the <code>Slug</code> header</li>
<li>MAY provide the <code>In-Progress</code> header</li>
</ul>
<p><strong>Server Requirements</strong></p>
<ul>
<li>If <code>Authorization</code> (and optionally <code>On-Behalf-Of</code>) headers are provided, MUST authenticate the request</li>
<li>MUST verify that the content matches the <code>Digest</code> header</li>
<li>MUST verify that the supplied content matches the <code>Content-Length</code> if this is provided</li>
<li>If all preconditions are met, MUST either accept the deposit request immediately, queue the request for processing, or respond with an error</li>
<li>If no <code>Metadata-Format</code> header is provided, MUST assume this is the standard SWORD format: http://purl.org/net/sword/3.0/types/Metadata</li>
<li>If a <code>Slug</code> header is provided, MAY use this as the identifier for the newly created Object.</li>
<li>If no <code>In-Progress</code> header is provided, MUST assume that it is <code>false</code></li>
<li>If <code>In-Progress</code> is <code>false</code>, SHOULD expect further updates to the item, and not progress it through any ingest workflows yet.</li>
<li>If accepting the request MUST populate the Object with the supplied Metadata</li>
<li>If accepting the request MUST create a new Object</li>
</ul>
<p><strong>Response Requirements</strong></p>
<ul>
<li>If authentication fails, MUST respond with a <code>403</code></li>
<li>MUST include <code>ETag</code> header if implementing concurrency control</li>
<li>MUST include one or more File-URLs for the deposited content in the Status document.  The behaviour of these File-URLs may vary depending on the type of content deposited (e.g. ByReference and Segmented Uploads do not need to be immediately retrievable)</li>
<li>MUST respond with a <code>Location</code> header, containing the Object-URL</li>
<li>MUST respond with a valid Status document or a suitable error response</li>
<li>Status document MUST be available on GET to the Object-URL in the <code>Location</code> header immediately (irrespective of whether this is a <code>201</code> or <code>202</code> response)</li>
<li>MUST respond with a <code>201</code> if the item was created immediately, a <code>202</code> if the item was queued for import, or raise an error.</li>
</ul>
<p>The <code>Content-Disposition</code> in this case would be:</p>
<pre><code>Content-Disposition: attachment; metadata=true
</code></pre>

<p><a name="2.2."></a></p>
<h2>2.2. Creating Objects with only By-Reference Files</h2>
<p>Create a new Object on the server, sending on By-Reference Files (i.e. no Binary Files and no Metadata)</p>
<p><strong>Protocol Operation</strong></p>
<ul>
<li>POST Service-URL</li>
</ul>
<p><strong>Request Requirements</strong></p>
<ul>
<li>MAY specify <code>Authorization</code> and <code>On-Behalf-Of</code> headers (i.e. if authenticating this request)</li>
<li>MUST provide the <code>Content-Disposition</code> header, with the appropriate value for the request</li>
<li>MUST provide the <code>Content-Type</code> and <code>Digest</code> headers</li>
<li>SHOULD provide the <code>Content-Length</code></li>
<li>MUST provide the By-Reference document</li>
<li>MAY provide the <code>Slug</code> header</li>
<li>MAY provide the <code>In-Progress</code> header</li>
</ul>
<p><strong>Server Requirements</strong></p>
<ul>
<li>If <code>Authorization</code> (and optionally <code>On-Behalf-Of</code>) headers are provided, MUST authenticate the request</li>
<li>MUST verify that the content matches the <code>Digest</code> header</li>
<li>MUST verify that the supplied content matches the <code>Content-Length</code> if this is provided</li>
<li>If all preconditions are met, MUST either accept the deposit request immediately, queue the request for processing, or respond with an error</li>
<li>If downloading copies of the files in the By-Reference document, MUST do this asynchronously to the deposit request</li>
<li>If a <code>Slug</code> header is provided, MAY use this as the identifier for the newly created Object.</li>
<li>If no <code>In-Progress</code> header is provided, MUST assume that it is <code>false</code></li>
<li>If <code>In-Progress</code> is <code>false</code>, SHOULD expect further updates to the item, and not progress it through any ingest workflows yet.</li>
<li>If accepting the request MUST attach the By-Reference files to the Object.</li>
<li>If accepting the request MUST create a new Object</li>
</ul>
<p><strong>Response Requirements</strong></p>
<ul>
<li>If authentication fails, MUST respond with a <code>403</code></li>
<li>MUST include <code>ETag</code> header if implementing concurrency control</li>
<li>MUST include one or more File-URLs for the deposited content in the Status document.  The behaviour of these File-URLs may vary depending on the type of content deposited (e.g. ByReference and Segmented Uploads do not need to be immediately retrievable)</li>
<li>MUST respond with a <code>Location</code> header, containing the Object-URL</li>
<li>MUST respond with a valid Status document or a suitable error response</li>
<li>Status document MUST be available on GET to the Object-URL in the <code>Location</code> header immediately (irrespective of whether this is a <code>201</code> or <code>202</code> response)</li>
<li>MUST respond with a <code>201</code> if the item was created immediately, a <code>202</code> if the item was queued for import, or raise an error.</li>
</ul>
<p>The <code>Content-Disposition</code> in this case would be:</p>
<pre><code>Content-Disposition: attachment; by-reference=true
</code></pre>

<p><a name="2.3."></a></p>
<h2>2.3. Creating Objects with both Metadata and By-Reference Files</h2>
<p>Create a new Object on the server, sending both Metadata content and By-Reference Files (i.e. no Binary File content)</p>
<p><strong>Protocol Operation</strong></p>
<ul>
<li>POST Service-URL</li>
</ul>
<p><strong>Request Requirements</strong></p>
<ul>
<li>MAY specify <code>Authorization</code> and <code>On-Behalf-Of</code> headers (i.e. if authenticating this request)</li>
<li>MUST provide the <code>Content-Disposition</code> header, with the appropriate value for the request</li>
<li>MUST provide the <code>Content-Type</code> and <code>Digest</code> headers</li>
<li>SHOULD provide the <code>Content-Length</code></li>
<li>SHOULD provide the <code>Metadata-Format</code> header</li>
<li>MUST provide the Metadata+By Reference document</li>
<li>MAY provide the <code>Slug</code> header</li>
<li>MAY provide the <code>In-Progress</code> header</li>
</ul>
<p><strong>Server Requirements</strong></p>
<ul>
<li>If <code>Authorization</code> (and optionally <code>On-Behalf-Of</code>) headers are provided, MUST authenticate the request</li>
<li>MUST verify that the content matches the <code>Digest</code> header</li>
<li>MUST verify that the supplied content matches the <code>Content-Length</code> if this is provided</li>
<li>If all preconditions are met, MUST either accept the deposit request immediately, queue the request for processing, or respond with an error</li>
<li>If no <code>Metadata-Format</code> header is provided, MUST assume this is the standard SWORD format: http://purl.org/net/sword/3.0/types/Metadata</li>
<li>If downloading copies of the files in the By-Reference document, MUST do this asynchronously to the deposit request</li>
<li>If a <code>Slug</code> header is provided, MAY use this as the identifier for the newly created Object.</li>
<li>If no <code>In-Progress</code> header is provided, MUST assume that it is <code>false</code></li>
<li>If <code>In-Progress</code> is <code>false</code>, SHOULD expect further updates to the item, and not progress it through any ingest workflows yet.</li>
<li>If accepting the request MUST populate the Object with the supplied Metadata, and attach the By-Reference files to it.</li>
<li>If accepting the request MUST create a new Object</li>
</ul>
<p><strong>Response Requirements</strong></p>
<ul>
<li>If authentication fails, MUST respond with a <code>403</code></li>
<li>MUST include <code>ETag</code> header if implementing concurrency control</li>
<li>MUST include one or more File-URLs for the deposited content in the Status document.  The behaviour of these File-URLs may vary depending on the type of content deposited (e.g. ByReference and Segmented Uploads do not need to be immediately retrievable)</li>
<li>MUST respond with a <code>Location</code> header, containing the Object-URL</li>
<li>MUST respond with a valid Status document or a suitable error response</li>
<li>Status document MUST be available on GET to the Object-URL in the <code>Location</code> header immediately (irrespective of whether this is a <code>201</code> or <code>202</code> response)</li>
<li>MUST respond with a <code>201</code> if the item was created immediately, a <code>202</code> if the item was queued for import, or raise an error.</li>
</ul>
<p>The <code>Content-Disposition</code> in this case would be:</p>
<pre><code>Content-Disposition: attachment; metadata=true; by-reference=true
</code></pre>

<p><a name="2.4."></a></p>
<h2>2.4. Creating Objects with Binary Files</h2>
<p>Create a new Object on the server, sending a single Binary File.  The Binary File is an opaque bitstream which the server should not 
attempt to unpack.</p>
<p><strong>Protocol Operation</strong></p>
<ul>
<li>POST Service-URL</li>
</ul>
<p><strong>Request Requirements</strong></p>
<ul>
<li>MAY specify <code>Authorization</code> and <code>On-Behalf-Of</code> headers (i.e. if authenticating this request)</li>
<li>MUST provide the <code>Content-Disposition</code> header, with the appropriate value for the request</li>
<li>MUST provide the <code>Content-Type</code> and <code>Digest</code> headers</li>
<li>SHOULD provide the <code>Content-Length</code></li>
<li>MAY provide the <code>Packaging</code> header, and if so MUST be the Binary format identifier</li>
<li>MUST provide Binary File body content</li>
<li>MAY provide the <code>Slug</code> header</li>
<li>MAY provide the <code>In-Progress</code> header</li>
</ul>
<p><strong>Server Requirements</strong></p>
<ul>
<li>If <code>Authorization</code> (and optionally <code>On-Behalf-Of</code>) headers are provided, MUST authenticate the request</li>
<li>MUST verify that the content matches the <code>Digest</code> header</li>
<li>MUST verify that the supplied content matches the <code>Content-Length</code> if this is provided</li>
<li>If all preconditions are met, MUST either accept the deposit request immediately, queue the request for processing, or respond with an error</li>
<li>If accepting the request MUST attach the supplied file to the Object as an <code>originalDeposit</code></li>
<li>The server SHOULD NOT attempt to unpack the file</li>
<li>If a <code>Slug</code> header is provided, MAY use this as the identifier for the newly created Object.</li>
<li>If no <code>In-Progress</code> header is provided, MUST assume that it is <code>false</code></li>
<li>If <code>In-Progress</code> is <code>false</code>, SHOULD expect further updates to the item, and not progress it through any ingest workflows yet.</li>
<li>If accepting the request MUST create a new Object</li>
</ul>
<p><strong>Response Requirements</strong></p>
<ul>
<li>If authentication fails, MUST respond with a <code>403</code></li>
<li>MUST include <code>ETag</code> header if implementing concurrency control</li>
<li>MUST include one or more File-URLs for the deposited content in the Status document.  The behaviour of these File-URLs may vary depending on the type of content deposited (e.g. ByReference and Segmented Uploads do not need to be immediately retrievable)</li>
<li>MUST respond with a <code>Location</code> header, containing the Object-URL</li>
<li>MUST respond with a valid Status document or a suitable error response</li>
<li>Status document MUST be available on GET to the Object-URL in the <code>Location</code> header immediately (irrespective of whether this is a <code>201</code> or <code>202</code> response)</li>
<li>MUST respond with a <code>201</code> if the item was created immediately, a <code>202</code> if the item was queued for import, or raise an error.</li>
</ul>
<p>The <code>Content-Disposition</code> in this case would be:</p>
<pre><code>Content-Disposition: attachment; filename=[filename]
</code></pre>

<p><a name="2.5."></a></p>
<h2>2.5. Creating Objects with Packaged Content</h2>
<p>Create a new Object on the server, sending a single Binary File.  The Binary File itself is specified as Packaged Content, which the server 
may understand how to unpack.</p>
<p><strong>Protocol Operation</strong></p>
<ul>
<li>POST Service-URL</li>
</ul>
<p><strong>Request Requirements</strong></p>
<ul>
<li>MAY specify <code>Authorization</code> and <code>On-Behalf-Of</code> headers (i.e. if authenticating this request)</li>
<li>MUST provide the <code>Content-Disposition</code> header, with the appropriate value for the request</li>
<li>MUST provide the <code>Content-Type</code> and <code>Digest</code> headers</li>
<li>SHOULD provide the <code>Content-Length</code></li>
<li>MUST provide the <code>Packaging</code> header</li>
<li>MUST provide Packaged Content in the request body</li>
<li>MAY provide the <code>Slug</code> header</li>
<li>MAY provide the <code>In-Progress</code> header</li>
</ul>
<p><strong>Server Requirements</strong></p>
<ul>
<li>If <code>Authorization</code> (and optionally <code>On-Behalf-Of</code>) headers are provided, MUST authenticate the request</li>
<li>MUST verify that the content matches the <code>Digest</code> header</li>
<li>MUST verify that the supplied content matches the <code>Content-Length</code> if this is provided</li>
<li>If all preconditions are met, MUST either accept the deposit request immediately, queue the request for processing, or respond with an error</li>
<li>If accepting the request MUST attach the supplied file to the Object as an <code>originalDeposit</code></li>
<li>The server MAY attempt to unpack the file, and create <code>derivedResource</code>s from it.</li>
<li>If a <code>Slug</code> header is provided, MAY use this as the identifier for the newly created Object.</li>
<li>If no <code>In-Progress</code> header is provided, MUST assume that it is <code>false</code></li>
<li>If <code>In-Progress</code> is <code>false</code>, SHOULD expect further updates to the item, and not progress it through any ingest workflows yet.</li>
<li>If accepting the request MUST create a new Object</li>
</ul>
<p><strong>Response Requirements</strong></p>
<ul>
<li>If authentication fails, MUST respond with a <code>403</code></li>
<li>MUST include <code>ETag</code> header if implementing concurrency control</li>
<li>MUST include one or more File-URLs for the deposited content in the Status document.  The behaviour of these File-URLs may vary depending on the type of content deposited (e.g. ByReference and Segmented Uploads do not need to be immediately retrievable)</li>
<li>MUST respond with a <code>Location</code> header, containing the Object-URL</li>
<li>MUST respond with a valid Status document or a suitable error response</li>
<li>Status document MUST be available on GET to the Object-URL in the <code>Location</code> header immediately (irrespective of whether this is a <code>201</code> or <code>202</code> response)</li>
<li>MUST respond with a <code>201</code> if the item was created immediately, a <code>202</code> if the item was queued for import, or raise an error.</li>
</ul>
<p>The <code>Content-Disposition</code> in this case would be:</p>
<pre><code>Content-Disposition: attachment; filename=[filename]
</code></pre>

<p><a name="2.6."></a></p>
<h2>2.6. Creating Objects with Segmented File Upload</h2>
<p>First create a Temporary-URL to which to upload the file segments:</p>
<p><strong>Protocol Operation</strong></p>
<ul>
<li>POST Staging-URL</li>
</ul>
<p><strong>Request Requirements</strong></p>
<ul>
<li>MAY specify <code>Authorization</code> and <code>On-Behalf-Of</code> headers (i.e. if authenticating this request)</li>
<li>MUST provide the <code>Content-Disposition</code> header, with the appropriate value for the request</li>
<li>MAY provide the <code>Content-Length</code> header with value <code>0</code></li>
<li>MUST NOT include any body content</li>
</ul>
<p><strong>Server Requirements</strong></p>
<ul>
<li>If <code>Authorization</code> (and optionally <code>On-Behalf-Of</code>) headers are provided, MUST authenticate the request</li>
<li>If all preconditions are met, MUST create a resource to which the client can upload file segments</li>
<li>MUST reject the request if the conditions of the upload are not acceptable</li>
</ul>
<p><strong>Response Requirements</strong></p>
<ul>
<li>If authentication fails, MUST respond with a <code>403</code></li>
<li>MUST respond with a <code>201</code> to indicate that the Segmented Upload has been initialised, or raise an error.</li>
<li>MUST respond with a <code>Location</code> header containing the Temporary-URL where the client can upload file segments</li>
</ul>
<p>The <code>Content-Disposition</code> in this case would be:</p>
<pre><code>Content-Disposition: segment-init; size=[bytes]; digest=[digest]; segment_count=[n]; segment_size=[bytes]
</code></pre>

<p>Then upload all the file segments as per <a href="#7.2.">Upload a File Segment</a>.</p>
<p>Then carry out a By-Reference deposit using the Temporary-URL as per <a href="#2.2.">Creating Objects with only By-Reference Files</a></p>
<p><a name="3."></a></p>
<h1>3. Retrieving all or part of Objects</h1>
<p><a name="3.1."></a></p>
<h2>3.1. Retrieving an Object's Status</h2>
<p>For an Object where you have an Object-URL, you may request information about the current state of that resource, and receive the Status 
document in response.</p>
<p><strong>Protocol Operation</strong></p>
<ul>
<li>GET Object-URL</li>
</ul>
<p><strong>Request Requirements</strong></p>
<ul>
<li>MAY specify <code>Authorization</code> and <code>On-Behalf-Of</code> headers (i.e. if authenticating this request)</li>
</ul>
<p><strong>Server Requirements</strong></p>
<ul>
<li>If <code>Authorization</code> (and optionally <code>On-Behalf-Of</code>) headers are provided, MUST authenticate the request</li>
</ul>
<p><strong>Response Requirements</strong></p>
<ul>
<li>If authentication fails, MUST respond with a <code>403</code></li>
<li>MUST respond with a valid Status document or a suitable error response</li>
<li>MUST include <code>ETag</code> header if implementing concurrency control</li>
</ul>
<p><a name="3.2."></a></p>
<h2>3.2. Retrieving the Metadata from an Object</h2>
<p>Retrieve the descriptive Metadata document associated with the Object in the standard SWORD format.  This operation is done against the 
Metadata-URL, which is the resource URL representing the Objectâ€™s metadata.  When retrieved, this resource is serialised only as the 
standard SWORD format, content negotiation is not supported.  If you want to retrieve the metadata for the Object in other formats, you can 
see a list of the available formats in the Status document, and the individual expressions of the metadata can then be retrieved directly 
by the appropriate URL.</p>
<p><strong>Protocol Operation</strong></p>
<ul>
<li>GET Metadata-URL</li>
</ul>
<p><strong>Request Requirements</strong></p>
<ul>
<li>MAY specify <code>Authorization</code> and <code>On-Behalf-Of</code> headers (i.e. if authenticating this request)</li>
</ul>
<p><strong>Server Requirements</strong></p>
<ul>
<li>If <code>Authorization</code> (and optionally <code>On-Behalf-Of</code>) headers are provided, MUST authenticate the request</li>
</ul>
<p><strong>Response Requirements</strong></p>
<ul>
<li>If authentication fails, MUST respond with a <code>403</code></li>
<li>MUST include <code>ETag</code> header if implementing concurrency control</li>
<li>MUST respond with a valid Metadata document (see definition below) or a suitable error response</li>
</ul>
<p><a name="3.3."></a></p>
<h2>3.3. Retrieving a Binary File from an Object</h2>
<p>Retrieve a single File from the Object; files available for retrieval are listed in the Status document.  These single files could be 
actual individual files that make up the object, or:</p>
<ul>
<li>Packaged Content that contains a full representation of the Object, including all its files and metadata, packaged according to some standard.</li>
<li>Metadata in specific formats supported by the server</li>
</ul>
<p><strong>Protocol Operation</strong></p>
<ul>
<li>GET File-URL</li>
</ul>
<p><strong>Request Requirements</strong></p>
<ul>
<li>MAY specify <code>Authorization</code> and <code>On-Behalf-Of</code> headers (i.e. if authenticating this request)</li>
</ul>
<p><strong>Server Requirements</strong></p>
<ul>
<li>If <code>Authorization</code> (and optionally <code>On-Behalf-Of</code>) headers are provided, MUST authenticate the request</li>
</ul>
<p><strong>Response Requirements</strong></p>
<ul>
<li>If authentication fails, MUST respond with a <code>403</code></li>
<li>MUST include <code>ETag</code> header if implementing concurrency control</li>
<li>MUST respond with a File (which may be Packaged Content, a Binary File, a Metadata document, or any other file that the server exposes) or a suitable error response</li>
</ul>
<p><a name="3.4."></a></p>
<h2>3.4. Retrieving a Packaged Content representation of an Object</h2>
<p>To retrieve the full Object packaged according to some Packaging format, the Status document contains all the files that the Object 
contains, and identifies those which allow you to retrieve the entire objects as a package.  Use the Status document to obtain the URL for 
the format you wish to retrieve, and make a GET to that URL.  See the section "Retrieving a Binary File from an Object" for the 
specification of this operation.</p>
<p><a name="4."></a></p>
<h1>4. Appending to existing Objects</h1>
<p>Metadata and Files may be added to existing Objects through a variety of mechanisms, which are listed in this section.</p>
<p><a name="4.1."></a></p>
<h2>4.1. Appending Metadata to an Object</h2>
<p>Append new metadata to an Object.  Metadata provided in this way should be considered to 
extend existing metadata, such that any new metadata fields are added to the Object, and any existing metadata fields are kept as-is.</p>
<p><strong>Protocol Operation</strong></p>
<ul>
<li>POST Object-URL</li>
</ul>
<p><strong>Request Requirements</strong></p>
<ul>
<li>MAY specify <code>Authorization</code> and <code>On-Behalf-Of</code> headers (i.e. if authenticating this request)</li>
<li>MUST provide the <code>Content-Disposition</code> header, with the appropriate value for the request</li>
<li>MUST provide the <code>Content-Type</code> and <code>Digest</code> headers</li>
<li>SHOULD provide the <code>Content-Length</code></li>
<li>SHOULD provide the <code>Metadata-Format</code> header</li>
<li>MUST provide only the Metadata document</li>
<li>MUST include the <code>If-Match</code> header, if the server implements concurrency control</li>
<li>MAY provide the <code>In-Progress</code> header</li>
</ul>
<p><strong>Server Requirements</strong></p>
<ul>
<li>If <code>Authorization</code> (and optionally <code>On-Behalf-Of</code>) headers are provided, MUST authenticate the request</li>
<li>MUST verify that the content matches the <code>Digest</code> header</li>
<li>MUST verify that the supplied content matches the <code>Content-Length</code> if this is provided</li>
<li>If all preconditions are met, MUST either accept the deposit request immediately, queue the request for processing, or respond with an error</li>
<li>If no <code>Metadata-Format</code> header is provided, MUST assume this is the standard SWORD format: http://purl.org/net/sword/3.0/types/Metadata</li>
<li>MUST reject the request if the <code>If-Match</code> header does not match the current <code>ETag</code> of the resource</li>
<li>If no <code>In-Progress</code> header is provided, MUST assume that it is <code>false</code></li>
<li>If accepting the new Metadata MUST add the Metadata to the item, and only treat this as an extension to existing Metadata.  The server MUST NOT overwrite or otherwise remove existing Metadata.</li>
</ul>
<p><strong>Response Requirements</strong></p>
<ul>
<li>If authentication fails, MUST respond with a <code>403</code></li>
<li>MUST include <code>ETag</code> header if implementing concurrency control</li>
<li>MUST include one or more File-URLs for the deposited content in the Status document.  The behaviour of these File-URLs may vary depending on the type of content deposited (e.g. ByReference and Segmented Uploads do not need to be immediately retrievable)</li>
<li>MUST respond with a <code>200</code> if the request was accepted immediately, a <code>202</code> if the request was queued for processing, or raise an error.</li>
<li>MUST respond with a valid Status document or a suitable error response</li>
<li>MUST include <code>ETag</code> header if implementing concurrency control</li>
</ul>
<p>The <code>Content-Disposition</code> in this case would be:</p>
<pre><code>Content-Disposition: attachment; metadata=true
</code></pre>

<p><a name="4.2."></a></p>
<h2>4.2. Appending By-Reference Files to an Object</h2>
<p>Append new files to an Object by sending one or more By-Reference files.</p>
<p><strong>Protocol Operation</strong></p>
<ul>
<li>POST Object-URL</li>
</ul>
<p><strong>Request Requirements</strong></p>
<ul>
<li>MAY specify <code>Authorization</code> and <code>On-Behalf-Of</code> headers (i.e. if authenticating this request)</li>
<li>MUST provide the <code>Content-Disposition</code> header, with the appropriate value for the request</li>
<li>MUST provide the <code>Content-Type</code> and <code>Digest</code> headers</li>
<li>SHOULD provide the <code>Content-Length</code></li>
<li>MUST provide the By-Reference document</li>
<li>MUST include the <code>If-Match</code> header, if the server implements concurrency control</li>
<li>MAY provide the <code>In-Progress</code> header</li>
</ul>
<p><strong>Server Requirements</strong></p>
<ul>
<li>If <code>Authorization</code> (and optionally <code>On-Behalf-Of</code>) headers are provided, MUST authenticate the request</li>
<li>MUST verify that the content matches the <code>Digest</code> header</li>
<li>MUST verify that the supplied content matches the <code>Content-Length</code> if this is provided</li>
<li>If all preconditions are met, MUST either accept the deposit request immediately, queue the request for processing, or respond with an error</li>
<li>If downloading copies of the files in the By-Reference document, MUST do this asynchronously to the deposit request</li>
<li>MUST reject the request if the <code>If-Match</code> header does not match the current <code>ETag</code> of the resource</li>
<li>If no <code>In-Progress</code> header is provided, MUST assume that it is <code>false</code></li>
<li>If accepting the request, MUST attach all the By-Reference files to the Object as <code>originalDeposit</code>s</li>
</ul>
<p><strong>Response Requirements</strong></p>
<ul>
<li>If authentication fails, MUST respond with a <code>403</code></li>
<li>MUST include <code>ETag</code> header if implementing concurrency control</li>
<li>MUST include one or more File-URLs for the deposited content in the Status document.  The behaviour of these File-URLs may vary depending on the type of content deposited (e.g. ByReference and Segmented Uploads do not need to be immediately retrievable)</li>
<li>MUST respond with a <code>200</code> if the request was accepted immediately, a <code>202</code> if the request was queued for processing, or raise an error.</li>
<li>MUST respond with a valid Status document or a suitable error response</li>
<li>MUST include <code>ETag</code> header if implementing concurrency control</li>
</ul>
<p>The <code>Content-Disposition</code> in this case would be:</p>
<pre><code>Content-Disposition: attachment; by-reference=true
</code></pre>

<p><a name="4.3."></a></p>
<h2>4.3. Appending Metadata and By-Reference Files to an Object</h2>
<p>Append new files and append/overlay Metadata at the same time.</p>
<p><strong>Protocol Operation</strong></p>
<ul>
<li>POST Object-URL</li>
</ul>
<p><strong>Request Requirements</strong></p>
<ul>
<li>MAY specify <code>Authorization</code> and <code>On-Behalf-Of</code> headers (i.e. if authenticating this request)</li>
<li>MUST provide the <code>Content-Disposition</code> header, with the appropriate value for the request</li>
<li>MUST provide the <code>Content-Type</code> and <code>Digest</code> headers</li>
<li>SHOULD provide the <code>Content-Length</code></li>
<li>SHOULD provide the <code>Metadata-Format</code> header</li>
<li>MUST provide the Metadata+By Reference document</li>
<li>MUST include the <code>If-Match</code> header, if the server implements concurrency control</li>
<li>MAY provide the <code>In-Progress</code> header</li>
</ul>
<p><strong>Server Requirements</strong></p>
<ul>
<li>If <code>Authorization</code> (and optionally <code>On-Behalf-Of</code>) headers are provided, MUST authenticate the request</li>
<li>MUST verify that the content matches the <code>Digest</code> header</li>
<li>MUST verify that the supplied content matches the <code>Content-Length</code> if this is provided</li>
<li>If all preconditions are met, MUST either accept the deposit request immediately, queue the request for processing, or respond with an error</li>
<li>If no <code>Metadata-Format</code> header is provided, MUST assume this is the standard SWORD format: http://purl.org/net/sword/3.0/types/Metadata</li>
<li>If downloading copies of the files in the By-Reference document, MUST do this asynchronously to the deposit request</li>
<li>MUST reject the request if the <code>If-Match</code> header does not match the current <code>ETag</code> of the resource</li>
<li>If no <code>In-Progress</code> header is provided, MUST assume that it is <code>false</code></li>
<li>If accepting the request, MUST attach all the By-Reference files to the Object as <code>originalDeposit</code>s, and MUST add the Metadata to the item, and only treat this as an extension to existing Metadata.  The server MUST NOT overwrite or otherwise remove existing Metadata.</li>
</ul>
<p><strong>Response Requirements</strong></p>
<ul>
<li>If authentication fails, MUST respond with a <code>403</code></li>
<li>MUST include <code>ETag</code> header if implementing concurrency control</li>
<li>MUST include one or more File-URLs for the deposited content in the Status document.  The behaviour of these File-URLs may vary depending on the type of content deposited (e.g. ByReference and Segmented Uploads do not need to be immediately retrievable)</li>
<li>MUST respond with a <code>200</code> if the request was accepted immediately, a <code>202</code> if the request was queued for processing, or raise an error.</li>
<li>MUST respond with a valid Status document or a suitable error response</li>
<li>MUST include <code>ETag</code> header if implementing concurrency control</li>
</ul>
<p>The <code>Content-Disposition</code> in this case would be:</p>
<pre><code>Content-Disposition: attachment; metadata=true; by-reference=true
</code></pre>

<p><a name="4.4."></a></p>
<h2>4.4. Appending a single Binary File to an Object</h2>
<p>Append new File to the Object, in addition to existing content which it already contains.  This File will be added as-is to the Object, 
without the server unpacking it as it would Packaged Content.</p>
<p><strong>Protocol Operation</strong></p>
<ul>
<li>POST Object-URL</li>
</ul>
<p><strong>Request Requirements</strong></p>
<ul>
<li>MAY specify <code>Authorization</code> and <code>On-Behalf-Of</code> headers (i.e. if authenticating this request)</li>
<li>MUST provide the <code>Content-Disposition</code> header, with the appropriate value for the request</li>
<li>MUST provide the <code>Content-Type</code> and <code>Digest</code> headers</li>
<li>SHOULD provide the <code>Content-Length</code></li>
<li>MAY provide the <code>Packaging</code> header, and if so MUST be the Binary format identifier</li>
<li>MUST provide Binary File body content</li>
<li>MUST include the <code>If-Match</code> header, if the server implements concurrency control</li>
<li>MAY provide the <code>In-Progress</code> header</li>
</ul>
<p><strong>Server Requirements</strong></p>
<ul>
<li>If <code>Authorization</code> (and optionally <code>On-Behalf-Of</code>) headers are provided, MUST authenticate the request</li>
<li>MUST verify that the content matches the <code>Digest</code> header</li>
<li>MUST verify that the supplied content matches the <code>Content-Length</code> if this is provided</li>
<li>If all preconditions are met, MUST either accept the deposit request immediately, queue the request for processing, or respond with an error</li>
<li>If accepting the request MUST attach the supplied file to the Object as an <code>originalDeposit</code></li>
<li>The server SHOULD NOT attempt to unpack the file</li>
<li>MUST reject the request if the <code>If-Match</code> header does not match the current <code>ETag</code> of the resource</li>
<li>If no <code>In-Progress</code> header is provided, MUST assume that it is <code>false</code></li>
</ul>
<p><strong>Response Requirements</strong></p>
<ul>
<li>If authentication fails, MUST respond with a <code>403</code></li>
<li>MUST include <code>ETag</code> header if implementing concurrency control</li>
<li>MUST include one or more File-URLs for the deposited content in the Status document.  The behaviour of these File-URLs may vary depending on the type of content deposited (e.g. ByReference and Segmented Uploads do not need to be immediately retrievable)</li>
<li>MUST respond with a <code>200</code> if the request was accepted immediately, a <code>202</code> if the request was queued for processing, or raise an error.</li>
<li>MUST respond with a valid Status document or a suitable error response</li>
<li>MUST include <code>ETag</code> header if implementing concurrency control</li>
<li>MUST respond with a <code>Location</code> header, containing the File-URL of the Original Deposit File</li>
</ul>
<p>The <code>Content-Disposition</code> in this case would be:</p>
<pre><code>Content-Disposition: attachment; filename=[filename]
</code></pre>

<p><a name="4.5."></a></p>
<h2>4.5. Appending Packaged Content to an Object</h2>
<p>Append new Files (via Packaged Content) to the Object, in addition to existing content which it already contains.  The package may be 
unpacked by the server and new file resources added.  Metadata may also be appended/selectively updated, if the package contains 
actionable metadata.</p>
<p><strong>Protocol Operation</strong></p>
<ul>
<li>POST Object-URL</li>
</ul>
<p><strong>Request Requirements</strong></p>
<ul>
<li>MAY specify <code>Authorization</code> and <code>On-Behalf-Of</code> headers (i.e. if authenticating this request)</li>
<li>MUST provide the <code>Content-Disposition</code> header, with the appropriate value for the request</li>
<li>MUST provide the <code>Content-Type</code> and <code>Digest</code> headers</li>
<li>SHOULD provide the <code>Content-Length</code></li>
<li>MUST provide the <code>Packaging</code> header</li>
<li>MUST provide Packaged Content in the request body</li>
<li>MUST include the <code>If-Match</code> header, if the server implements concurrency control</li>
<li>MAY provide the <code>In-Progress</code> header</li>
</ul>
<p><strong>Server Requirements</strong></p>
<ul>
<li>If <code>Authorization</code> (and optionally <code>On-Behalf-Of</code>) headers are provided, MUST authenticate the request</li>
<li>MUST verify that the content matches the <code>Digest</code> header</li>
<li>MUST verify that the supplied content matches the <code>Content-Length</code> if this is provided</li>
<li>If all preconditions are met, MUST either accept the deposit request immediately, queue the request for processing, or respond with an error</li>
<li>If accepting the request MUST attach the supplied file to the Object as an <code>originalDeposit</code></li>
<li>The server MAY attempt to unpack the file, and create <code>derivedResource</code>s from it.</li>
<li>MUST reject the request if the <code>If-Match</code> header does not match the current <code>ETag</code> of the resource</li>
<li>If no <code>In-Progress</code> header is provided, MUST assume that it is <code>false</code></li>
</ul>
<p><strong>Response Requirements</strong></p>
<ul>
<li>If authentication fails, MUST respond with a <code>403</code></li>
<li>MUST include <code>ETag</code> header if implementing concurrency control</li>
<li>MUST include one or more File-URLs for the deposited content in the Status document.  The behaviour of these File-URLs may vary depending on the type of content deposited (e.g. ByReference and Segmented Uploads do not need to be immediately retrievable)</li>
<li>MUST respond with a <code>200</code> if the request was accepted immediately, a <code>202</code> if the request was queued for processing, or raise an error.</li>
<li>MUST respond with a valid Status document or a suitable error response</li>
<li>MUST include <code>ETag</code> header if implementing concurrency control</li>
<li>MUST respond with a <code>Location</code> header, containing the File-URL of the Original Deposit File</li>
</ul>
<p>The <code>Content-Disposition</code> in this case would be:</p>
<pre><code>Content-Disposition: attachment; filename=[filename]
</code></pre>

<p><a name="4.6."></a></p>
<h2>4.6. Append of Binary Files to an Object via Segmented File Upload</h2>
<p>Append a single Binary File to an Object which will be delivered via a Segmented File Upload.</p>
<p>First create a Temporary-URL to which to upload the file segments:</p>
<p><strong>Protocol Operation</strong></p>
<ul>
<li>POST Staging-URL</li>
</ul>
<p><strong>Request Requirements</strong></p>
<ul>
<li>MAY specify <code>Authorization</code> and <code>On-Behalf-Of</code> headers (i.e. if authenticating this request)</li>
<li>MUST provide the <code>Content-Disposition</code> header, with the appropriate value for the request</li>
<li>MAY provide the <code>Content-Length</code> header with value <code>0</code></li>
<li>MUST NOT include any body content</li>
</ul>
<p><strong>Server Requirements</strong></p>
<ul>
<li>If <code>Authorization</code> (and optionally <code>On-Behalf-Of</code>) headers are provided, MUST authenticate the request</li>
<li>If all preconditions are met, MUST create a resource to which the client can upload file segments</li>
<li>MUST reject the request if the conditions of the upload are not acceptable</li>
</ul>
<p><strong>Response Requirements</strong></p>
<ul>
<li>If authentication fails, MUST respond with a <code>403</code></li>
<li>MUST respond with a <code>201</code> to indicate that the Segmented Upload has been initialised, or raise an error.</li>
<li>MUST respond with a <code>Location</code> header containing the Temporary-URL where the client can upload file segments</li>
</ul>
<p>The <code>Content-Disposition</code> in this case would be:</p>
<pre><code>Content-Disposition: segment-init; size=[bytes]; digest=[digest]; segment_count=[n]; segment_size=[bytes]
</code></pre>

<p>Then upload all the file segments as per <a href="#7.2.">Upload a File Segment</a>.</p>
<p>Then carry out a By-Reference deposit using the Temporary-URL as per <a href="#4.2.">Appending By-Reference Files to an Object</a></p>
<p><a name="4.7."></a></p>
<h2>4.7. Append of Packaged Content to an Object via Segmented File Upload</h2>
<p>As <a href="#4.6.">Append of Binary Files to an Object via Segmented File Upload</a>. </p>
<p><a name="5."></a></p>
<h1>5. Replacing all or part of existing Objects</h1>
<p>Metadata and Files may be replaced in existing Objects through a variety of mechanisms, which are listed in this section.</p>
<p><a name="5.1."></a></p>
<h2>5.1. Replacing the Metadata of an Object</h2>
<p>Replace in its entirety the Metadata associated with an Object.</p>
<p><strong>Protocol Operation</strong></p>
<ul>
<li>PUT Metadata-URL</li>
</ul>
<p><strong>Request Requirements</strong></p>
<ul>
<li>MAY specify <code>Authorization</code> and <code>On-Behalf-Of</code> headers (i.e. if authenticating this request)</li>
<li>MUST provide the <code>Content-Disposition</code> header, with the appropriate value for the request</li>
<li>MUST provide the <code>Content-Type</code> and <code>Digest</code> headers</li>
<li>SHOULD provide the <code>Content-Length</code></li>
<li>SHOULD provide the <code>Metadata-Format</code> header</li>
<li>MUST provide only the Metadata document</li>
<li>MUST include the <code>If-Match</code> header, if the server implements concurrency control</li>
</ul>
<p><strong>Server Requirements</strong></p>
<ul>
<li>If <code>Authorization</code> (and optionally <code>On-Behalf-Of</code>) headers are provided, MUST authenticate the request</li>
<li>MUST verify that the content matches the <code>Digest</code> header</li>
<li>MUST verify that the supplied content matches the <code>Content-Length</code> if this is provided</li>
<li>If all preconditions are met, MUST either accept the deposit request immediately, queue the request for processing, or respond with an error</li>
<li>If no <code>Metadata-Format</code> header is provided, MUST assume this is the standard SWORD format: http://purl.org/net/sword/3.0/types/Metadata</li>
<li>MUST reject the request if the <code>If-Match</code> header does not match the current <code>ETag</code> of the resource</li>
<li>If accepting the new Metadata MUST entirely replace the existing Metadata with the new.</li>
</ul>
<p><strong>Response Requirements</strong></p>
<ul>
<li>If authentication fails, MUST respond with a <code>403</code></li>
<li>MUST include <code>ETag</code> header if implementing concurrency control</li>
<li>MUST include one or more File-URLs for the deposited content in the Status document.  The behaviour of these File-URLs may vary depending on the type of content deposited (e.g. ByReference and Segmented Uploads do not need to be immediately retrievable)</li>
<li>MUST respond with a <code>200</code> if the request was accepted immediately, a <code>202</code> if the request was queued for processing, or raise an error.</li>
<li>MUST respond with a <code>204</code> if the replacement was deposited immediately, a <code>202</code> if the replacement was queued for import, or raise an error.</li>
</ul>
<p>The <code>Content-Disposition</code> in this case would be:</p>
<pre><code>Content-Disposition: attachment; metadata=true
</code></pre>

<p><a name="5.2."></a></p>
<h2>5.2. Replacing a single File in an Object</h2>
<p>Replace an existing file in the Object with a new file.  The server may keep the old version of the file available.</p>
<p><strong>Protocol Operation</strong></p>
<ul>
<li>PUT File-URL</li>
</ul>
<p><strong>Request Requirements</strong></p>
<ul>
<li>MAY specify <code>Authorization</code> and <code>On-Behalf-Of</code> headers (i.e. if authenticating this request)</li>
<li>MUST provide the <code>Content-Disposition</code> header, with the appropriate value for the request</li>
<li>MUST provide the <code>Content-Type</code> and <code>Digest</code> headers</li>
<li>SHOULD provide the <code>Content-Length</code></li>
<li>MAY provide the <code>Packaging</code> header, and if so MUST be the Binary format identifier</li>
<li>MUST provide Binary File body content</li>
<li>MUST include the <code>If-Match</code> header, if the server implements concurrency control</li>
</ul>
<p><strong>Server Requirements</strong></p>
<ul>
<li>If <code>Authorization</code> (and optionally <code>On-Behalf-Of</code>) headers are provided, MUST authenticate the request</li>
<li>MUST verify that the content matches the <code>Digest</code> header</li>
<li>MUST verify that the supplied content matches the <code>Content-Length</code> if this is provided</li>
<li>If all preconditions are met, MUST either accept the deposit request immediately, queue the request for processing, or respond with an error</li>
<li>If accepting the request MUST attach the supplied file to the Object as an <code>originalDeposit</code></li>
<li>The server SHOULD NOT attempt to unpack the file</li>
<li>MUST reject the request if the <code>If-Match</code> header does not match the current <code>ETag</code> of the resource</li>
<li>If accepting the new File, MUST replace the existing File.  The server MAY keep the previous file as an older version.  The new File MUST be marked as an <code>originalDeposit</code></li>
</ul>
<p><strong>Response Requirements</strong></p>
<ul>
<li>If authentication fails, MUST respond with a <code>403</code></li>
<li>MUST include <code>ETag</code> header if implementing concurrency control</li>
<li>MUST include one or more File-URLs for the deposited content in the Status document.  The behaviour of these File-URLs may vary depending on the type of content deposited (e.g. ByReference and Segmented Uploads do not need to be immediately retrievable)</li>
<li>MUST respond with a <code>200</code> if the request was accepted immediately, a <code>202</code> if the request was queued for processing, or raise an error.</li>
<li>MUST respond with a <code>204</code> if the replacement was deposited immediately, a <code>202</code> if the replacement was queued for import, or raise an error.</li>
</ul>
<p>The <code>Content-Disposition</code> in this case would be:</p>
<pre><code>Content-Disposition: attachment; filename=[filename]
</code></pre>

<p><a name="5.3."></a></p>
<h2>5.3. Replacing a single File in an Object with a By-Reference File</h2>
<p>Replace an existing file in the Object with a new file which the server retrieves as a By-Reference File.  The server may keep the old
version of the file available.</p>
<p><strong>Protocol Operation</strong></p>
<ul>
<li>PUT File-URL</li>
</ul>
<p><strong>Request Requirements</strong></p>
<ul>
<li>MAY specify <code>Authorization</code> and <code>On-Behalf-Of</code> headers (i.e. if authenticating this request)</li>
<li>MUST provide the <code>Content-Disposition</code> header, with the appropriate value for the request</li>
<li>MUST provide the <code>Content-Type</code> and <code>Digest</code> headers</li>
<li>SHOULD provide the <code>Content-Length</code></li>
<li>MUST provide the By-Reference document</li>
<li>MUST only include a single By-Reference File in the By-Reference document</li>
<li>MUST include the <code>If-Match</code> header, if the server implements concurrency control</li>
</ul>
<p><strong>Server Requirements</strong></p>
<ul>
<li>If <code>Authorization</code> (and optionally <code>On-Behalf-Of</code>) headers are provided, MUST authenticate the request</li>
<li>MUST verify that the content matches the <code>Digest</code> header</li>
<li>MUST verify that the supplied content matches the <code>Content-Length</code> if this is provided</li>
<li>If all preconditions are met, MUST either accept the deposit request immediately, queue the request for processing, or respond with an error</li>
<li>If downloading copies of the files in the By-Reference document, MUST do this asynchronously to the deposit request</li>
<li>If more than one By-Reference File is present, MUST reject the request.</li>
<li>MUST reject the request if the <code>If-Match</code> header does not match the current <code>ETag</code> of the resource</li>
<li>If accepting the new By-Reference File, MUST replace the existing File.  The server MAY keep the previous file as an older version.  The new file MUST be marked as an <code>originalDeposit</code></li>
</ul>
<p><strong>Response Requirements</strong></p>
<ul>
<li>If authentication fails, MUST respond with a <code>403</code></li>
<li>MUST include <code>ETag</code> header if implementing concurrency control</li>
<li>MUST include one or more File-URLs for the deposited content in the Status document.  The behaviour of these File-URLs may vary depending on the type of content deposited (e.g. ByReference and Segmented Uploads do not need to be immediately retrievable)</li>
<li>If rejecting the request due to the presence of more than one By-Reference File in the By-Reference Document, MUST respond with a <code>400</code></li>
<li>MUST respond with a <code>200</code> if the request was accepted immediately, a <code>202</code> if the request was queued for processing, or raise an error.</li>
<li>MUST respond with a <code>204</code> if the replacement was deposited immediately, a <code>202</code> if the replacement was queued for import, or raise an error.</li>
</ul>
<p>The <code>Content-Disposition</code> in this case would be:</p>
<pre><code>Content-Disposition: attachment; by-reference=true
</code></pre>

<p><a name="5.4."></a></p>
<h2>5.4. Replacing a single File in an Object with a Segmented Upload</h2>
<p>Replace an existing file in the Object with a new file, which the client will send in segments.  </p>
<p>First create a Temporary-URL to which to upload the file segments:</p>
<p><strong>Protocol Operation</strong></p>
<ul>
<li>POST Staging-URL</li>
</ul>
<p><strong>Request Requirements</strong></p>
<ul>
<li>MAY specify <code>Authorization</code> and <code>On-Behalf-Of</code> headers (i.e. if authenticating this request)</li>
<li>MUST provide the <code>Content-Disposition</code> header, with the appropriate value for the request</li>
<li>MAY provide the <code>Content-Length</code> header with value <code>0</code></li>
<li>MUST NOT include any body content</li>
</ul>
<p><strong>Server Requirements</strong></p>
<ul>
<li>If <code>Authorization</code> (and optionally <code>On-Behalf-Of</code>) headers are provided, MUST authenticate the request</li>
<li>If all preconditions are met, MUST create a resource to which the client can upload file segments</li>
<li>MUST reject the request if the conditions of the upload are not acceptable</li>
</ul>
<p><strong>Response Requirements</strong></p>
<ul>
<li>If authentication fails, MUST respond with a <code>403</code></li>
<li>MUST respond with a <code>201</code> to indicate that the Segmented Upload has been initialised, or raise an error.</li>
<li>MUST respond with a <code>Location</code> header containing the Temporary-URL where the client can upload file segments</li>
</ul>
<p>The <code>Content-Disposition</code> in this case would be:</p>
<pre><code>Content-Disposition: segment-init; size=[bytes]; digest=[digest]; segment_count=[n]; segment_size=[bytes]
</code></pre>

<p>Then upload all the file segments as per <a href="#7.2.">Upload a File Segment</a>.</p>
<p>Then carry out a By-Reference deposit using the Temporary-URL as per <a href="#5.3.">Replacing a single File in an Object with a By-Reference File</a></p>
<p><a name="5.5."></a></p>
<h2>5.5. Replacing the FileSet of an Object with By-Reference Files</h2>
<p>Replace all the files in the FileSet of an Object with one or more By-Reference Files.  All previously existing files will be removed, and
new ones will replace them.  The server may or may not keep old versions of the content available, at its discretion.</p>
<p><strong>Protocol Operation</strong></p>
<ul>
<li>PUT FileSet-URL</li>
</ul>
<p><strong>Request Requirements</strong></p>
<ul>
<li>MAY specify <code>Authorization</code> and <code>On-Behalf-Of</code> headers (i.e. if authenticating this request)</li>
<li>MUST provide the <code>Content-Disposition</code> header, with the appropriate value for the request</li>
<li>MUST provide the <code>Content-Type</code> and <code>Digest</code> headers</li>
<li>SHOULD provide the <code>Content-Length</code></li>
<li>MUST provide the By-Reference document</li>
<li>MUST include the <code>If-Match</code> header, if the server implements concurrency control</li>
</ul>
<p><strong>Server Requirements</strong></p>
<ul>
<li>If <code>Authorization</code> (and optionally <code>On-Behalf-Of</code>) headers are provided, MUST authenticate the request</li>
<li>MUST verify that the content matches the <code>Digest</code> header</li>
<li>MUST verify that the supplied content matches the <code>Content-Length</code> if this is provided</li>
<li>If all preconditions are met, MUST either accept the deposit request immediately, queue the request for processing, or respond with an error</li>
<li>If downloading copies of the files in the By-Reference document, MUST do this asynchronously to the deposit request</li>
<li>MUST reject the request if the <code>If-Match</code> header does not match the current <code>ETag</code> of the resource</li>
<li>If accepting the new By-Reference Files, MUST replace the existing FileSet with the new files.  The server MUST remove all the old files immediately, even before the new By-Reference files have been dereferenced.  The new Files MUST be marked as <code>originalDeposit</code>s</li>
</ul>
<p><strong>Response Requirements</strong></p>
<ul>
<li>If authentication fails, MUST respond with a <code>403</code></li>
<li>MUST include <code>ETag</code> header if implementing concurrency control</li>
<li>MUST include one or more File-URLs for the deposited content in the Status document.  The behaviour of these File-URLs may vary depending on the type of content deposited (e.g. ByReference and Segmented Uploads do not need to be immediately retrievable)</li>
<li>MUST respond with a <code>200</code> if the request was accepted immediately, a <code>202</code> if the request was queued for processing, or raise an error.</li>
<li>MUST respond with a <code>204</code> if the replacement was deposited immediately, a <code>202</code> if the replacement was queued for import, or raise an error.</li>
</ul>
<p>The <code>Content-Disposition</code> in this case would be:</p>
<pre><code>Content-Disposition: attachment; by-reference=true
</code></pre>

<p><a name="5.6."></a></p>
<h2>5.6. Replacing the FileSet of an Object with a single Binary File</h2>
<p>Replace in its entirety the FileSet of the Object (i.e. not the Metadata), with a single Binary File.  All previously existing files will 
be removed, and the new one will replace them.  The server may or may not keep old versions of the content available, at its discretion.</p>
<p><strong>Protocol Operation</strong></p>
<ul>
<li>PUT FileSet-URL</li>
</ul>
<p><strong>Request Requirements</strong></p>
<ul>
<li>MAY specify <code>Authorization</code> and <code>On-Behalf-Of</code> headers (i.e. if authenticating this request)</li>
<li>MUST provide the <code>Content-Disposition</code> header, with the appropriate value for the request</li>
<li>MUST provide the <code>Content-Type</code> and <code>Digest</code> headers</li>
<li>SHOULD provide the <code>Content-Length</code></li>
<li>MAY provide the <code>Packaging</code> header, and if so MUST be the Binary format identifier</li>
<li>MUST provide Binary File body content</li>
<li>MUST include the <code>If-Match</code> header, if the server implements concurrency control</li>
</ul>
<p><strong>Server Requirements</strong></p>
<ul>
<li>If <code>Authorization</code> (and optionally <code>On-Behalf-Of</code>) headers are provided, MUST authenticate the request</li>
<li>MUST verify that the content matches the <code>Digest</code> header</li>
<li>MUST verify that the supplied content matches the <code>Content-Length</code> if this is provided</li>
<li>If all preconditions are met, MUST either accept the deposit request immediately, queue the request for processing, or respond with an error</li>
<li>If accepting the request MUST attach the supplied file to the Object as an <code>originalDeposit</code></li>
<li>The server SHOULD NOT attempt to unpack the file</li>
<li>MUST reject the request if the <code>If-Match</code> header does not match the current <code>ETag</code> of the resource</li>
<li>If accepting the new File, MUST replace the existing FileSet with a single new File.  The File MUST be marked as an <code>originalDeposit</code></li>
</ul>
<p><strong>Response Requirements</strong></p>
<ul>
<li>If authentication fails, MUST respond with a <code>403</code></li>
<li>MUST include <code>ETag</code> header if implementing concurrency control</li>
<li>MUST include one or more File-URLs for the deposited content in the Status document.  The behaviour of these File-URLs may vary depending on the type of content deposited (e.g. ByReference and Segmented Uploads do not need to be immediately retrievable)</li>
<li>MUST respond with a <code>200</code> if the request was accepted immediately, a <code>202</code> if the request was queued for processing, or raise an error.</li>
<li>MUST respond with a <code>204</code> if the replacement was deposited immediately, a <code>202</code> if the replacement was queued for import, or raise an error.</li>
</ul>
<p>The <code>Content-Disposition</code> in this case would be:</p>
<pre><code>Content-Disposition: attachment; filename=[filename]
</code></pre>

<p><a name="5.7."></a></p>
<h2>5.7. Replacing the FileSet of an Object with a single Binary File via Segmented File Upload</h2>
<p>Replace in its entirity the FileSet of the Object (i.e. not the Metadata), with a single Binary File, that is provided via Segmented File Upload.
All previously existing files will be removed, and the new one will replace them.  The server may or may not keep old versions of the 
content available, at its discretion.</p>
<p>First create a Temporary-URL to which to upload the file segments:</p>
<p><strong>Protocol Operation</strong></p>
<ul>
<li>POST Staging-URL</li>
</ul>
<p><strong>Request Requirements</strong></p>
<ul>
<li>MAY specify <code>Authorization</code> and <code>On-Behalf-Of</code> headers (i.e. if authenticating this request)</li>
<li>MUST provide the <code>Content-Disposition</code> header, with the appropriate value for the request</li>
<li>MAY provide the <code>Content-Length</code> header with value <code>0</code></li>
<li>MUST NOT include any body content</li>
</ul>
<p><strong>Server Requirements</strong></p>
<ul>
<li>If <code>Authorization</code> (and optionally <code>On-Behalf-Of</code>) headers are provided, MUST authenticate the request</li>
<li>If all preconditions are met, MUST create a resource to which the client can upload file segments</li>
<li>MUST reject the request if the conditions of the upload are not acceptable</li>
</ul>
<p><strong>Response Requirements</strong></p>
<ul>
<li>If authentication fails, MUST respond with a <code>403</code></li>
<li>MUST respond with a <code>201</code> to indicate that the Segmented Upload has been initialised, or raise an error.</li>
<li>MUST respond with a <code>Location</code> header containing the Temporary-URL where the client can upload file segments</li>
</ul>
<p>The <code>Content-Disposition</code> in this case would be:</p>
<pre><code>Content-Disposition: segment-init; size=[bytes]; digest=[digest]; segment_count=[n]; segment_size=[bytes]
</code></pre>

<p>Then upload all the file segments as per <a href="#7.2.">Upload a File Segment</a>.</p>
<p>Then carry out a By-Reference deposit using the Temporary-URL as per <a href="#5.5.">Replacing the FileSet of an Object with By-Reference Files</a></p>
<p><a name="5.8."></a></p>
<h2>5.8. Replacing an Object with Metadata only</h2>
<p>Replace the entire Object, removing all previous files and metadata, and replace it with just the supplied Metadata.  The server may or may 
not keep old versions of the content available, at its discretion.</p>
<p><strong>Protocol Operation</strong></p>
<ul>
<li>PUT Object-URL</li>
</ul>
<p><strong>Request Requirements</strong></p>
<ul>
<li>MAY specify <code>Authorization</code> and <code>On-Behalf-Of</code> headers (i.e. if authenticating this request)</li>
<li>MUST provide the <code>Content-Disposition</code> header, with the appropriate value for the request</li>
<li>MUST provide the <code>Content-Type</code> and <code>Digest</code> headers</li>
<li>SHOULD provide the <code>Content-Length</code></li>
<li>SHOULD provide the <code>Metadata-Format</code> header</li>
<li>MUST provide only the Metadata document</li>
<li>MUST include the <code>If-Match</code> header, if the server implements concurrency control</li>
<li>MAY provide the <code>In-Progress</code> header</li>
</ul>
<p><strong>Server Requirements</strong></p>
<ul>
<li>If <code>Authorization</code> (and optionally <code>On-Behalf-Of</code>) headers are provided, MUST authenticate the request</li>
<li>MUST verify that the content matches the <code>Digest</code> header</li>
<li>MUST verify that the supplied content matches the <code>Content-Length</code> if this is provided</li>
<li>If all preconditions are met, MUST either accept the deposit request immediately, queue the request for processing, or respond with an error</li>
<li>If no <code>Metadata-Format</code> header is provided, MUST assume this is the standard SWORD format: http://purl.org/net/sword/3.0/types/Metadata</li>
<li>MUST reject the request if the <code>If-Match</code> header does not match the current <code>ETag</code> of the resource</li>
<li>If no <code>In-Progress</code> header is provided, MUST assume that it is <code>false</code></li>
<li>If accepting the new Metadata, MUST remove all existing Files from the Object, and MUST replace the existing Metadata with the new.</li>
</ul>
<p><strong>Response Requirements</strong></p>
<ul>
<li>If authentication fails, MUST respond with a <code>403</code></li>
<li>MUST include <code>ETag</code> header if implementing concurrency control</li>
<li>MUST include one or more File-URLs for the deposited content in the Status document.  The behaviour of these File-URLs may vary depending on the type of content deposited (e.g. ByReference and Segmented Uploads do not need to be immediately retrievable)</li>
<li>MUST respond with a <code>200</code> if the request was accepted immediately, a <code>202</code> if the request was queued for processing, or raise an error.</li>
<li>MUST respond with a valid Status document or a suitable error response</li>
<li>MUST include <code>ETag</code> header if implementing concurrency control</li>
</ul>
<p>The <code>Content-Disposition</code> in this case would be:</p>
<pre><code>Content-Disposition: attachment; metadata=true
</code></pre>

<p><a name="5.9."></a></p>
<h2>5.9. Replacing an Object with By-Reference Files only</h2>
<p>Replace the entire Object, removing all previous files and metadata, and replace it with one or more files supplied via By-Reference upload.
The server may or may not keep old versions of the content available, at its discretion.</p>
<p><strong>Protocol Operation</strong></p>
<ul>
<li>PUT Object-URL</li>
</ul>
<p><strong>Request Requirements</strong></p>
<ul>
<li>MAY specify <code>Authorization</code> and <code>On-Behalf-Of</code> headers (i.e. if authenticating this request)</li>
<li>MUST provide the <code>Content-Disposition</code> header, with the appropriate value for the request</li>
<li>MUST provide the <code>Content-Type</code> and <code>Digest</code> headers</li>
<li>SHOULD provide the <code>Content-Length</code></li>
<li>MUST provide the By-Reference document</li>
<li>MUST include the <code>If-Match</code> header, if the server implements concurrency control</li>
<li>MAY provide the <code>In-Progress</code> header</li>
</ul>
<p><strong>Server Requirements</strong></p>
<ul>
<li>If <code>Authorization</code> (and optionally <code>On-Behalf-Of</code>) headers are provided, MUST authenticate the request</li>
<li>MUST verify that the content matches the <code>Digest</code> header</li>
<li>MUST verify that the supplied content matches the <code>Content-Length</code> if this is provided</li>
<li>If all preconditions are met, MUST either accept the deposit request immediately, queue the request for processing, or respond with an error</li>
<li>If downloading copies of the files in the By-Reference document, MUST do this asynchronously to the deposit request</li>
<li>MUST reject the request if the <code>If-Match</code> header does not match the current <code>ETag</code> of the resource</li>
<li>If no <code>In-Progress</code> header is provided, MUST assume that it is <code>false</code></li>
<li>If accepting the new By-Reference files, MUST remove all existing Files from the Object and replace with the By-Reference files.  The server MUST remove the existing Files immediately, even before the By-Reference files have dereferenced.  The new files MUST be marked as <code>originalDeposit</code>s.  The server MUST also remove all Metadata, so the Metadata Resource contains no fields.</li>
</ul>
<p><strong>Response Requirements</strong></p>
<ul>
<li>If authentication fails, MUST respond with a <code>403</code></li>
<li>MUST include <code>ETag</code> header if implementing concurrency control</li>
<li>MUST include one or more File-URLs for the deposited content in the Status document.  The behaviour of these File-URLs may vary depending on the type of content deposited (e.g. ByReference and Segmented Uploads do not need to be immediately retrievable)</li>
<li>MUST respond with a <code>200</code> if the request was accepted immediately, a <code>202</code> if the request was queued for processing, or raise an error.</li>
<li>MUST respond with a valid Status document or a suitable error response</li>
<li>MUST include <code>ETag</code> header if implementing concurrency control</li>
</ul>
<p>The <code>Content-Disposition</code> in this case would be:</p>
<pre><code>Content-Disposition: attachment; by-reference=true
</code></pre>

<p><a name="5.10."></a></p>
<h2>5.10. Replacing an Object with Metadata and By-Reference Files</h2>
<p>Replace the entire Object, removing all previous files and metadata, and replace it with new Metadata and one or more files supplied via
By-Reference upload.  The server may or may not keep old versions of the content available, at its discretion.</p>
<p><strong>Protocol Operation</strong></p>
<ul>
<li>PUT Object-URL</li>
</ul>
<p><strong>Request Requirements</strong></p>
<ul>
<li>MAY specify <code>Authorization</code> and <code>On-Behalf-Of</code> headers (i.e. if authenticating this request)</li>
<li>MUST provide the <code>Content-Disposition</code> header, with the appropriate value for the request</li>
<li>MUST provide the <code>Content-Type</code> and <code>Digest</code> headers</li>
<li>SHOULD provide the <code>Content-Length</code></li>
<li>SHOULD provide the <code>Metadata-Format</code> header</li>
<li>MUST provide the Metadata+By Reference document</li>
<li>MUST include the <code>If-Match</code> header, if the server implements concurrency control</li>
<li>MAY provide the <code>In-Progress</code> header</li>
</ul>
<p><strong>Server Requirements</strong></p>
<ul>
<li>If <code>Authorization</code> (and optionally <code>On-Behalf-Of</code>) headers are provided, MUST authenticate the request</li>
<li>MUST verify that the content matches the <code>Digest</code> header</li>
<li>MUST verify that the supplied content matches the <code>Content-Length</code> if this is provided</li>
<li>If all preconditions are met, MUST either accept the deposit request immediately, queue the request for processing, or respond with an error</li>
<li>If no <code>Metadata-Format</code> header is provided, MUST assume this is the standard SWORD format: http://purl.org/net/sword/3.0/types/Metadata</li>
<li>If downloading copies of the files in the By-Reference document, MUST do this asynchronously to the deposit request</li>
<li>MUST reject the request if the <code>If-Match</code> header does not match the current <code>ETag</code> of the resource</li>
<li>If no <code>In-Progress</code> header is provided, MUST assume that it is <code>false</code></li>
<li>If accepting the new Metadata and By-Reference files, MUST remove all existing Files from the Object and replace with the By-Reference files.  The server MUST remove the existing Files immediately, even before the By-Reference files have dereferenced.  The server MUST also replace all existing Metadata with the new Metadata.</li>
</ul>
<p><strong>Response Requirements</strong></p>
<ul>
<li>If authentication fails, MUST respond with a <code>403</code></li>
<li>MUST include <code>ETag</code> header if implementing concurrency control</li>
<li>MUST include one or more File-URLs for the deposited content in the Status document.  The behaviour of these File-URLs may vary depending on the type of content deposited (e.g. ByReference and Segmented Uploads do not need to be immediately retrievable)</li>
<li>MUST respond with a <code>200</code> if the request was accepted immediately, a <code>202</code> if the request was queued for processing, or raise an error.</li>
<li>MUST respond with a valid Status document or a suitable error response</li>
<li>MUST include <code>ETag</code> header if implementing concurrency control</li>
</ul>
<p>The <code>Content-Disposition</code> in this case would be:</p>
<pre><code>Content-Disposition: attachment; metadata=true; by-reference=true
</code></pre>

<p><a name="5.11."></a></p>
<h2>5.11. Replacing an Object with a single Binary File</h2>
<p>Replace in its entirety the Object, including all Metadata and Files, with the single Binary File.  All previous files and metadata will be 
removed, and new ones will replace them (the updated item will have no Metadata, though).  The server may or may not keep old versions of 
the content available.</p>
<p><strong>Protocol Operation</strong></p>
<ul>
<li>PUT Object-URL</li>
</ul>
<p><strong>Request Requirements</strong></p>
<ul>
<li>MAY specify <code>Authorization</code> and <code>On-Behalf-Of</code> headers (i.e. if authenticating this request)</li>
<li>MUST provide the <code>Content-Disposition</code> header, with the appropriate value for the request</li>
<li>MUST provide the <code>Content-Type</code> and <code>Digest</code> headers</li>
<li>SHOULD provide the <code>Content-Length</code></li>
<li>MAY provide the <code>Packaging</code> header, and if so MUST be the Binary format identifier</li>
<li>MUST provide Binary File body content</li>
<li>MUST include the <code>If-Match</code> header, if the server implements concurrency control</li>
<li>MAY provide the <code>In-Progress</code> header</li>
</ul>
<p><strong>Server Requirements</strong></p>
<ul>
<li>If <code>Authorization</code> (and optionally <code>On-Behalf-Of</code>) headers are provided, MUST authenticate the request</li>
<li>MUST verify that the content matches the <code>Digest</code> header</li>
<li>MUST verify that the supplied content matches the <code>Content-Length</code> if this is provided</li>
<li>If all preconditions are met, MUST either accept the deposit request immediately, queue the request for processing, or respond with an error</li>
<li>If accepting the request MUST attach the supplied file to the Object as an <code>originalDeposit</code></li>
<li>The server SHOULD NOT attempt to unpack the file</li>
<li>MUST reject the request if the <code>If-Match</code> header does not match the current <code>ETag</code> of the resource</li>
<li>If no <code>In-Progress</code> header is provided, MUST assume that it is <code>false</code></li>
<li>If accepting the new File, MUST remove all existing Files from the Object and replace with the new File.  The new File should be marked as an <code>originalDeposit</code>.  The server MUST also remove all Metadata, so the Metadata Resource contains no fields.</li>
</ul>
<p><strong>Response Requirements</strong></p>
<ul>
<li>If authentication fails, MUST respond with a <code>403</code></li>
<li>MUST include <code>ETag</code> header if implementing concurrency control</li>
<li>MUST include one or more File-URLs for the deposited content in the Status document.  The behaviour of these File-URLs may vary depending on the type of content deposited (e.g. ByReference and Segmented Uploads do not need to be immediately retrievable)</li>
<li>MUST respond with a <code>200</code> if the request was accepted immediately, a <code>202</code> if the request was queued for processing, or raise an error.</li>
<li>MUST respond with a valid Status document or a suitable error response</li>
<li>MUST include <code>ETag</code> header if implementing concurrency control</li>
</ul>
<p>The <code>Content-Disposition</code> in this case would be:</p>
<pre><code>Content-Disposition: attachment; filename=[filename]
</code></pre>

<p><a name="5.12."></a></p>
<h2>5.12. Replacing an Object with Packaged Content</h2>
<p>Replace in its entirety the Object, including all Metadata and Files, with the Metadata and Files contained in the Packaged Content.  All 
previous files and metadata will be removed, and new ones will replace them.  The server may or may not keep old versions of the content 
available.</p>
<p><strong>Protocol Operation</strong></p>
<ul>
<li>PUT Object-URL</li>
</ul>
<p><strong>Request Requirements</strong></p>
<ul>
<li>MAY specify <code>Authorization</code> and <code>On-Behalf-Of</code> headers (i.e. if authenticating this request)</li>
<li>MUST provide the <code>Content-Disposition</code> header, with the appropriate value for the request</li>
<li>MUST provide the <code>Content-Type</code> and <code>Digest</code> headers</li>
<li>SHOULD provide the <code>Content-Length</code></li>
<li>MUST provide the <code>Packaging</code> header</li>
<li>MUST provide Packaged Content in the request body</li>
<li>MUST include the <code>If-Match</code> header, if the server implements concurrency control</li>
<li>MAY provide the <code>In-Progress</code> header</li>
</ul>
<p><strong>Server Requirements</strong></p>
<ul>
<li>If <code>Authorization</code> (and optionally <code>On-Behalf-Of</code>) headers are provided, MUST authenticate the request</li>
<li>MUST verify that the content matches the <code>Digest</code> header</li>
<li>MUST verify that the supplied content matches the <code>Content-Length</code> if this is provided</li>
<li>If all preconditions are met, MUST either accept the deposit request immediately, queue the request for processing, or respond with an error</li>
<li>If accepting the request MUST attach the supplied file to the Object as an <code>originalDeposit</code></li>
<li>The server MAY attempt to unpack the file, and create <code>derivedResource</code>s from it.</li>
<li>MUST reject the request if the <code>If-Match</code> header does not match the current <code>ETag</code> of the resource</li>
<li>If no <code>In-Progress</code> header is provided, MUST assume that it is <code>false</code></li>
<li>If accepting the new File, MUST remove all existing Files from the Object and replace with the new File.  The new File should be marked as an <code>originalDeposit</code>.  The server MUST also remove all Metadata, so the Metadata Resource contains no fields.</li>
</ul>
<p><strong>Response Requirements</strong></p>
<ul>
<li>If authentication fails, MUST respond with a <code>403</code></li>
<li>MUST include <code>ETag</code> header if implementing concurrency control</li>
<li>MUST include one or more File-URLs for the deposited content in the Status document.  The behaviour of these File-URLs may vary depending on the type of content deposited (e.g. ByReference and Segmented Uploads do not need to be immediately retrievable)</li>
<li>MUST respond with a <code>200</code> if the request was accepted immediately, a <code>202</code> if the request was queued for processing, or raise an error.</li>
<li>MUST respond with a valid Status document or a suitable error response</li>
<li>MUST include <code>ETag</code> header if implementing concurrency control</li>
</ul>
<p>The <code>Content-Disposition</code> in this case would be:</p>
<pre><code>Content-Disposition: attachment; filename=[filename]
</code></pre>

<p><a name="5.13."></a></p>
<h2>5.13. Replacing an Object with a single Binary File via Segmented File Upload</h2>
<p>Replace in its entirety the Object, including all Metadata and Files, with a single Binary File, which will be delivered via Segmented
File Upload.  All previous files and metadata will be removed, and new ones will replace them.  The server may or may not keep old versions of 
the content available.</p>
<p>First create a Temporary-URL to which to upload the file segments:</p>
<p><strong>Protocol Operation</strong></p>
<ul>
<li>POST Staging-URL</li>
</ul>
<p><strong>Request Requirements</strong></p>
<ul>
<li>MAY specify <code>Authorization</code> and <code>On-Behalf-Of</code> headers (i.e. if authenticating this request)</li>
<li>MUST provide the <code>Content-Disposition</code> header, with the appropriate value for the request</li>
<li>MAY provide the <code>Content-Length</code> header with value <code>0</code></li>
<li>MUST NOT include any body content</li>
</ul>
<p><strong>Server Requirements</strong></p>
<ul>
<li>If <code>Authorization</code> (and optionally <code>On-Behalf-Of</code>) headers are provided, MUST authenticate the request</li>
<li>If all preconditions are met, MUST create a resource to which the client can upload file segments</li>
<li>MUST reject the request if the conditions of the upload are not acceptable</li>
</ul>
<p><strong>Response Requirements</strong></p>
<ul>
<li>If authentication fails, MUST respond with a <code>403</code></li>
<li>MUST respond with a <code>201</code> to indicate that the Segmented Upload has been initialised, or raise an error.</li>
<li>MUST respond with a <code>Location</code> header containing the Temporary-URL where the client can upload file segments</li>
</ul>
<p>The <code>Content-Disposition</code> in this case would be:</p>
<pre><code>Content-Disposition: segment-init; size=[bytes]; digest=[digest]; segment_count=[n]; segment_size=[bytes]
</code></pre>

<p>Then upload all the file segments as per <a href="#7.2.">Upload a File Segment</a>.</p>
<p>Then carry out a By-Reference deposit using the Temporary-URL as per <a href="#5.9.">Replacing an Object with By-Reference Files only</a></p>
<p><a name="5.14."></a></p>
<h2>5.14. Replacing an Object with Packaged Content via Segmented File Upload</h2>
<p>This operation is carried out exactly as per <a href="#5.13.">Replacing an Object with a single Binary File via Segmented File Upload</a>.</p>
<p><a name="6."></a></p>
<h1>6. Deleting all or part of Objects</h1>
<p><a name="6.1."></a></p>
<h2>6.1. Deleting an Object's Metadata</h2>
<p>Delete all the metadata fields from the Object.</p>
<p><strong>Protocol Operation</strong></p>
<ul>
<li>DELETE Metadata-URL</li>
</ul>
<p><strong>Request Requirements</strong></p>
<ul>
<li>MAY specify <code>Authorization</code> and <code>On-Behalf-Of</code> headers (i.e. if authenticating this request)</li>
</ul>
<p><strong>Server Requirements</strong></p>
<ul>
<li>If <code>Authorization</code> (and optionally <code>On-Behalf-Of</code>) headers are provided, MUST authenticate the request</li>
</ul>
<p><strong>Response Requirements</strong></p>
<ul>
<li>If authentication fails, MUST respond with a <code>403</code></li>
<li>MUST respond with a <code>204</code> if the delete is successful, or raise an error</li>
</ul>
<p><a name="6.2."></a></p>
<h2>6.2. Deleting a single Binary File from an Object</h2>
<p>Delete a single File from the Object.  The server may keep old versions of the file.</p>
<p><strong>Protocol Operation</strong></p>
<ul>
<li>DELETE File-URL</li>
</ul>
<p><strong>Request Requirements</strong></p>
<ul>
<li>MAY specify <code>Authorization</code> and <code>On-Behalf-Of</code> headers (i.e. if authenticating this request)</li>
</ul>
<p><strong>Server Requirements</strong></p>
<ul>
<li>If <code>Authorization</code> (and optionally <code>On-Behalf-Of</code>) headers are provided, MUST authenticate the request</li>
</ul>
<p><strong>Response Requirements</strong></p>
<ul>
<li>If authentication fails, MUST respond with a <code>403</code></li>
<li>MUST respond with a <code>204</code> if the delete is successful, or raise an error</li>
</ul>
<p><a name="6.3."></a></p>
<h2>6.3. Deleting all the Files from an Object</h2>
<p>Remove all the Files from an object.  This will leave the Object and its Metadata intact.  The server may keep old versions of the files 
available.</p>
<p><strong>Protocol Operation</strong></p>
<ul>
<li>DELETE FileSet-URL</li>
</ul>
<p><strong>Request Requirements</strong></p>
<ul>
<li>MAY specify <code>Authorization</code> and <code>On-Behalf-Of</code> headers (i.e. if authenticating this request)</li>
</ul>
<p><strong>Server Requirements</strong></p>
<ul>
<li>If <code>Authorization</code> (and optionally <code>On-Behalf-Of</code>) headers are provided, MUST authenticate the request</li>
</ul>
<p><strong>Response Requirements</strong></p>
<ul>
<li>If authentication fails, MUST respond with a <code>403</code></li>
<li>MUST respond with a <code>204</code> if the delete is successful, or raise an error</li>
</ul>
<p><a name="6.4."></a></p>
<h2>6.4. Deleting the entire Object</h2>
<p>Delete the Object in its entirety from the server, along with all Metadata and Files.</p>
<p><strong>Protocol Operation</strong></p>
<ul>
<li>DELETE Object-URL</li>
</ul>
<p><strong>Request Requirements</strong></p>
<ul>
<li>MAY specify <code>Authorization</code> and <code>On-Behalf-Of</code> headers (i.e. if authenticating this request)</li>
</ul>
<p><strong>Server Requirements</strong></p>
<ul>
<li>If <code>Authorization</code> (and optionally <code>On-Behalf-Of</code>) headers are provided, MUST authenticate the request</li>
</ul>
<p><strong>Response Requirements</strong></p>
<ul>
<li>If authentication fails, MUST respond with a <code>403</code></li>
<li>MUST respond with a <code>204</code> if the delete is successful, or raise an error</li>
</ul>
<p><a name="7."></a></p>
<h1>7. File Segments</h1>
<p><a name="7.1."></a></p>
<h2>7.1. Initialise a Segmented File Upload</h2>
<p><strong>Protocol Operation</strong></p>
<ul>
<li>POST Staging-URL</li>
</ul>
<p><strong>Request Requirements</strong></p>
<ul>
<li>MAY specify <code>Authorization</code> and <code>On-Behalf-Of</code> headers (i.e. if authenticating this request)</li>
<li>MUST provide the <code>Content-Disposition</code> header, with the appropriate value for the request</li>
<li>MAY provide the <code>Content-Length</code> header with value <code>0</code></li>
<li>MUST NOT include any body content</li>
</ul>
<p><strong>Server Requirements</strong></p>
<ul>
<li>If <code>Authorization</code> (and optionally <code>On-Behalf-Of</code>) headers are provided, MUST authenticate the request</li>
<li>If all preconditions are met, MUST create a resource to which the client can upload file segments</li>
<li>MUST reject the request if the conditions of the upload are not acceptable</li>
</ul>
<p><strong>Response Requirements</strong></p>
<ul>
<li>If authentication fails, MUST respond with a <code>403</code></li>
<li>MUST respond with a <code>201</code> to indicate that the Segmented Upload has been initialised, or raise an error.</li>
<li>MUST respond with a <code>Location</code> header containing the Temporary-URL where the client can upload file segments</li>
</ul>
<p>The <code>Content-Disposition</code> in this case would be:</p>
<pre><code>Content-Disposition: segment-init; size=[bytes]; digest=[digest]; segment_count=[n]; segment_size=[bytes]
</code></pre>

<p><a name="7.2."></a></p>
<h2>7.2. Upload a File Segment</h2>
<p><strong>Protocol Operation</strong></p>
<ul>
<li>POST Temporary-URL</li>
</ul>
<p><strong>Request Requirements</strong></p>
<ul>
<li>MAY specify <code>Authorization</code> and <code>On-Behalf-Of</code> headers (i.e. if authenticating this request)</li>
<li>MUST provide the <code>Content-Disposition</code> header, with the appropriate value for the request</li>
<li>MUST provide the <code>Content-Type</code> and <code>Digest</code> headers</li>
<li>SHOULD provide the <code>Content-Length</code></li>
</ul>
<p><strong>Server Requirements</strong></p>
<ul>
<li>If <code>Authorization</code> (and optionally <code>On-Behalf-Of</code>) headers are provided, MUST authenticate the request</li>
<li>MUST verify that the content matches the <code>Digest</code> header</li>
<li>MUST verify that the supplied content matches the <code>Content-Length</code> if this is provided</li>
<li>MUST reject the request if the segment is incorrect or unexpected: for example, all segments were already received, or the segment is a different size than expected.</li>
<li>If all preconditions are met, MUST accept the file segment, and record the receipt of it</li>
<li>MUST be prepared to accept file segments in any order, and in parallel</li>
<li>MUST be able to store the incoming file segments as they arrive, and then reconstitute them into a single file when all segments have been received.</li>
</ul>
<p><strong>Response Requirements</strong></p>
<ul>
<li>If authentication fails, MUST respond with a <code>403</code></li>
<li>MUST respond with a <code>204</code> or a suitable error</li>
</ul>
<p>The <code>Content-Disposition</code> in this case would be:</p>
<pre><code>Content-Disposition: segment; segment_number=[n]
</code></pre>

<p><a name="7.3."></a></p>
<h2>7.3. Abort a Segmented File Upload</h2>
<p><strong>Request Requirements</strong></p>
<ul>
<li>MAY specify <code>Authorization</code> and <code>On-Behalf-Of</code> headers (i.e. if authenticating this request)</li>
</ul>
<p><strong>Server Requirements</strong></p>
<ul>
<li>If <code>Authorization</code> (and optionally <code>On-Behalf-Of</code>) headers are provided, MUST authenticate the request</li>
</ul>
<p><strong>Response Requirements</strong></p>
<ul>
<li>If authentication fails, MUST respond with a <code>403</code></li>
<li>MUST respond with a <code>204</code> if the delete is successful, or raise an error</li>
</ul>
<p><a name="7.4."></a></p>
<h2>7.4. Retrieve information about a Segmented File Upload</h2>
<p><strong>Protocol Operation</strong></p>
<ul>
<li>GET Temporary-URL</li>
</ul>
<p><strong>Request Requirements</strong></p>
<ul>
<li>MAY specify <code>Authorization</code> and <code>On-Behalf-Of</code> headers (i.e. if authenticating this request)</li>
</ul>
<p><strong>Server Requirements</strong></p>
<ul>
<li>If <code>Authorization</code> (and optionally <code>On-Behalf-Of</code>) headers are provided, MUST authenticate the request</li>
</ul>
<p><strong>Response Requirements</strong></p>
<ul>
<li>If authentication fails, MUST respond with a <code>403</code></li>
<li>MUST respond with a <code>200</code> or a suitable error</li>
<li>If successful, MUST respond with a Segmented File Upload Document describing the current state of the upload.</li>
</ul>
<p><a name="8."></a></p>
<h1>8. Completing Previously In-Progress Deposits</h1>
<p>Where you have previously carried out deposits and sent the object the <code>In-Progress: true</code> header, you will eventually need to tell the
server that you have completed your additions or modifications to the Object, so that it can finalise your deposit.</p>
<p><strong>Protocol Operation</strong></p>
<ul>
<li>POST Object-URL</li>
</ul>
<p><strong>Request Requirements</strong></p>
<ul>
<li>MAY specify <code>Authorization</code> and <code>On-Behalf-Of</code> headers (i.e. if authenticating this request)</li>
<li>MUST provide the header <code>In-Progress: false</code></li>
<li>MAY provide the <code>Content-Length</code> header with value <code>0</code></li>
<li>MUST NOT include any body content</li>
</ul>
<p><strong>Server Requirements</strong></p>
<ul>
<li>If <code>Authorization</code> (and optionally <code>On-Behalf-Of</code>) headers are provided, MUST authenticate the request</li>
<li>MAY inject the content into any ingest workflows</li>
</ul>
<p><strong>Response Requirements</strong></p>
<ul>
<li>If authentication fails, MUST respond with a <code>403</code></li>
<li>MUST respond with a <code>204</code> or a suitable error</li>
</ul>
<p>No <code>Content-Disposition</code> header is required in this request.</p>
</div></body>
</html>

